<style type="text/css" media="screen">
  table tr td,
  table tfoot tr td
  {
    padding:     0.3em !important;
    line-height: 1em !important;
  }
  table tr.pending{
    background-color: rgb() !important;
  }
  table tr.info{
    background-color: rgb(145, 177, 199) !important;
  }
  table tr.success{
    background-color: rgb(200, 250, 180) !important;
  }
</style>


<table width="100%" border="0">
  <tr>
    <td>

      <div class="pagination">
        <span class="step-links">
          <span class="current">
            Page {{ videos.number }} of {{ videos.paginator.num_pages }}.
          </span>

          <br>

          <a href="?page={{ videos.next_page_number }}&search={{query}}">Next.</a>
          <br>
          <a href="?page={{ videos.previous_page_number }}&search={{query}}">Previous.</a>

          <br>
        </span>
      </div>

    </td>
    <td>

      <h2 ng-if="data.channel">{! data.channel.title !} <small>{! data.channel.chanid !} (on {! data.channel.service !})</small></h2>
      <h2 ng-if="!data.channel">All channels</h2>
    </td>
  </tr>
</table>

<table class="table table-striped table-hover table-condensed" id="videos">
  <thead>
    <th>Actions</th>
    <th>Title</th>
    <th width="75px">Status</th>
    <th width="160px">Released</th>
  </thead>

  <tr ng-repeat="video in data.videos">
    <td>
      <a ng-click="download(video)"><i class="fa fa-download"></i></a>
      <a ng-click="mark_viewed(video)"><i class="fa fa-check" title="Mark as viewed"></i></a>
      <a ng-click="mark_ignored(video)"><i class="fa fa-square-o" title="Mark video as ignored"></i></a>
    </td>
    <td>

      <a href="{% url 'ytdl.views.view_channel' v.channel.id %}"><img width="12px" src="{% url 'ytdl.views.channel_icon' v.channel.id %}"></a>

      <a href="{{ v.url }}">{! video.title !}</a>
      <a href="#" ng-if="!data.channel"><small style="color:grey"> [{! video.channel.title !}]</small></a>

      <a href="#" data-dropdown="{! video.id !}"><i class="fa fa-info-circle"></i></a>
      <div id="{! video.id !}" class="f-dropdown content medium" data-dropdown-content>
        <p ng-repeat="img for img in video.thumbnails">
          <img src="{! img !}" width="64">
        </p>

        {! video.description !}
      </div> 
    </td>
    <td>
      {! status(video) !}
    </td>
    <td>
      <abbr style="font-size:0.7em" class="timeago" title="{{ v.publishdate|date:'c' }}">{! video.publishdate !}</abbr>
    </td>
  </tr>
</table>

<p>
  <a ng-if="data.channel" href="{% url 'ytdl.views.refresh_channel' channel.id %}" class="async"><i class="icon-refresh"></i>Refresh {! data.channel.title !}</a>
  <a ng-if="!data.channel" href="{% url 'ytdl.views.refresh_all' %}" class="async"><i class="icon-refresh"></i>Refresh all</a>
</p>

<script type="text/javascript">
  $(function(){
  
    <!-- Download links -->
    $("a.async").each(function(i, ahref){
      $(ahref).click(function(evt){
        $(ahref).parent().parent().removeClass();
        $.ajax(ahref.href)
          .done(function(data, textStatus, jqXHR){
            <!-- Indicate something happened -->
            <!-- FIXME: This does not update status column, incorrect colours when marking as read etc. Awful. -->
            $(ahref).parent().parent().addClass("pending");})
          .fail(function(jqXHR, textStatus, errorThrown){
            <!-- Request failed (e.g already downloaded) -->
            $(ahref).parent().parent().addClass("error");});

        return false;
      });
    });

    <!-- Time ago -->
    $("abbr.timeago").timeago();

  });
</script>


<a href="#">Back</a>
