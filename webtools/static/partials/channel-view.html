<style type="text/css" media="screen">
  table tr td,
  table tfoot tr td
  {
    padding:     0.3em;
    line-height: 1em;
  }
  table tr.downloading{
    background: rgb();
  }
  table tr.new{
    background: rgb(145, 177, 199);
  }
  table tr.grabbed{
    background: rgb(200, 250, 180);
  }
</style>


<table width="100%" border="0">
  <tr>
    <td>

      <div class="pagination">
        <span class="step-links">
          <span class="current">
            Page {! data.pagination.current !} of {! data.pagination.total !}.
          </span>

          <br>

          <a ng-if="data.pagination.has_next" ng-click="next_page()">Next.</a>

          <br>
          <a ng-if="data.pagination.has_previous" ng-click="prev_page()">Previous.</a>

          <br>
        </span>
      </div>

    </td>
    <td>
      <span ng-if="data.channel">
        <h2>{! data.channel.title !} <small>({! data.channel.chanid !} on {! data.channel.service !})</small></h2>
      </span>
      <span ng-if="!data.channel">
        <h2>All channels</h2>
      </span>

    </td>
  </tr>
</table>



<table class="table table-striped table-hover table-condensed" id="videos">
  <thead>
    <th>Actions</th>
    <th>Title</th>
    <th width="75px">Status</th>
    <th width="160px">Released</th>
  </thead>

  <tr ng-repeat="video in data.videos" ng-class="class_for_status(video)">
    <td>

      <div ng-if="video.action_running" style="position:relative;">
        <div style="position: absolute; top:0; left:0; width: 100%; text-align:center; background-color: white; opacity: 0.9">
          <img src="/static/img/spinner.gif" alt="Loading indicator">
        </div>
      </div>

      <a ng-click="download(video)"><i class="fa fa-download"></i></a>
      <a ng-click="mark_viewed(video)"><i class="fa fa-check" title="Mark as viewed"></i></a>
      <a ng-click="mark_ignored(video)"><i class="fa fa-square-o" title="Mark video as ignored"></i></a>
    </td>

    <td>
      <a href="#/channels/{! video.channel.id !}"><img width="12px" ng-src="{! video.channel.icon !}"></a>

      <a href="">{! video.title !}</a>
      <a ng-if="!data.channel" href="#/channels/{! video.channel.id !}"><small style="color:grey"> [{! video.channel.title !}]</small></a>

      <a href="#" data-dropdown="{! video.id !}"><i class="fa fa-info-circle"></i></a>

      <div id="{! video.id !}" class="f-dropdown content medium" data-dropdown-content>
        <p ng-repeat="img in video.thumbnails">
          <img ng-src="{! img !}" width="64"> <!-- fixme -->
        </p>

        {! video.description !}
      </div> 
    </td>
    <td>
      {! status(video) !}
    </td>
    <td>
      <abbr style="font-size:0.7em" class="timeago" title="fixme">{! video.publishdate !}</abbr>
    </td>
  </tr>
</table>

<p>
  <a ng-if="data.channel" href="{% url 'ytdl.views.refresh_channel' channel.id %}" class="async"><i class="icon-refresh"></i>Refresh {! data.channel.title !}</a>
  <a ng-if="!data.channel" href="{% url 'ytdl.views.refresh_all' %}" class="async"><i class="icon-refresh"></i>Refresh all</a>
</p>

<script type="text/javascript">
  $(function(){
  
    <!-- Download links -->
    $("a.async").each(function(i, ahref){
      $(ahref).click(function(evt){
        $(ahref).parent().parent().removeClass();
        $.ajax(ahref.href)
          .done(function(data, textStatus, jqXHR){
            <!-- Indicate something happened -->
            <!-- FIXME: This does not update status column, incorrect colours when marking as read etc. Awful. -->
            $(ahref).parent().parent().addClass("pending");})
          .fail(function(jqXHR, textStatus, errorThrown){
            <!-- Request failed (e.g already downloaded) -->
            $(ahref).parent().parent().addClass("error");});

        return false;
      });
    });

    <!-- Time ago -->
    $("abbr.timeago").timeago();

  });
</script>


<a href="#">Back</a>
