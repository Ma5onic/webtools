{% extends "base.html" %}

{% block head %}
<link href="/static/css/pop.css" media="all" rel="stylesheet" type="text/css"/>
<script language="javascript" src="/static/js/jquery.pop.js" type="text/javascript"></script>
<script language="javascript" src="/static/js/jquery.timeago.js" type="text/javascript"></script>
{% endblock %}

{% block content %}

{% include "ytdl/navbar.html" %}

<table class="table table-striped table-hover table-condensed" id="videos">
  <colgroup>
    <col width="20px"></col>
    <col width="200px"></col>
    <col width="80px"></col>
    <col></col>
  </colgroup>
  <thead>
    <th></th>
    <th>Title</th>
    <th>Recent</th>
    <th>Total unviewed</th>
  </thead>
  <tr>
    <td></td>
    <td><a href="{% url 'ytdl.views.view_channel' '_all' %}">All channels</a></td>
    <td>0</td>
    <td>0</td>
  </tr>
  {% for chan in channels %}
  <tr>
    <td><a href="{% url 'ytdl.views.refresh_channel' chan.id %}" class="async"><i class="icon-refresh"></i></a></td>
    <td>
      <a href="{% url 'ytdl.views.view_channel' chan.id %}">
        <img width="12px" src="{% url 'ytdl.views.channel_icon' chan.id %}"> <span title="{{chan.chanid}}">{{ chan.title }}</span>
      </a>
    </td>
    <td>{{chan.num_unviewed_recently}}</td>
    <td>{{chan.num_unviewed}}</td>
  </tr>
  {% endfor %}

  <tr>
    <td></td>
    <td><a href="{% url 'ytdl.views.refresh_all' %}" class="async">Refresh all <i class="icon-refresh"></i></a></td>
  </tr>
</table>


<h2>Recent videos</h2>
<table class="table table-striped table-hover table-condensed" id="videos">
{% for v in recent %}
<tr>
  <td><a href="{% url 'ytdl.views.view_channel' v.channel.id %}">{{ v.title }}</a></td>
</tr>
{% endfor %}
</table>

<h2>Downloads
  <small><a href="{% url 'ytdl.views.view_channel' '_all' %}?status=GE">View errors &rarr;</a></small>
</h2>
<table class="table table-striped table-hover table-condensed" id="videos">
{% for v in downloads %}
<tr class="{{ v.status_class }}">
  <td>
    <a href="{% url 'ytdl.views.view_channel' v.channel.id %}?status={{v.status}}">{{ v.title }}</a>
    <a href="{% url 'ytdl.views.grab' v.id %}?force=true" class="async"><i class="icon-download-alt"></i></a>

  </td>
</tr>
{% endfor %}
</table>

<script type="text/javascript">
  $(function(){
  
    <!-- Download links -->
    $("a.async").each(function(i, ahref){
      $(ahref).click(function(evt){
        $.ajax(ahref.href);
        return false;
      });
    });

    <!-- Time ago -->
    $("abbr.timeago").timeago();

  });
</script>

{% endblock %}
